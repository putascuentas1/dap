<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dukes & Peasants — Leaderboard</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg-0: #0a0f14;
    --bg-1: #0f1620;
    --stroke: rgba(255,255,255,0.12);
    --text: #e6f1ff;
    --muted: #9fb3c8;
    --accent: #00e5ff;
    --accent-2: #2aff80;
    --shadow: 0 10px 30px rgba(0,0,0,0.4);
    --radius: 14px;
    --radius-sm: 10px;
    --focus: 0 0 0 2px rgba(0,229,255,0.5), 0 0 0 6px rgba(0,229,255,0.15);
    --bottom-pad: 180px;
    --mx: 50%;
    --my: 50%;
    --m-size: 180px;
    --m-scale: 1.6;
  }
  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body {
    margin: 0;
    overflow-y: auto;
    background: var(--bg-0);
    color: var(--text);
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol", sans-serif;
    line-height: 1.6;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  body::before, body::after {
    content: "";
    position: fixed; inset: 0;
    pointer-events: none; z-index: -3;
  }
  body::before {
    background:
      radial-gradient(60rem 60rem at 15% 10%, rgba(0,229,255,0.12), transparent 60%),
      radial-gradient(60rem 60rem at 85% 90%, rgba(42,255,128,0.10), transparent 60%),
      linear-gradient(180deg, var(--bg-1), var(--bg-0));
  }
  body::after {
    background-image:
      linear-gradient(rgba(255,255,255,0.04) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,255,255,0.04) 1px, transparent 1px);
    background-size: 46px 46px, 46px 46px;
    mask-image: radial-gradient(80rem 80rem at 50% 50%, rgba(0,0,0,0.55), transparent 75%);
    animation: gridFloat 14s ease-in-out infinite alternate;
  }
  @keyframes gridFloat { from { transform: translateY(0) } to { transform: translateY(-10px) } }
  .bg-magnifier {
    position: fixed; inset: 0; z-index: -2;
    pointer-events: none;
    opacity: 0;
    background:
      radial-gradient(60rem 60rem at 15% 10%, rgba(0,229,255,0.12), transparent 60%),
      radial-gradient(60rem 60rem at 85% 90%, rgba(42,255,128,0.10), transparent 60%),
      linear-gradient(180deg, var(--bg-1), var(--bg-0));
    background-attachment: fixed, fixed, fixed;
    transform-origin: var(--mx) var(--my);
    transform: translateZ(0) scale(var(--m-scale));
    filter: brightness(1.15) saturate(1.08);
    mask-image: radial-gradient(circle var(--m-size) at var(--mx) var(--my), rgba(0,0,0,1), rgba(0,0,0,0) 70%);
    -webkit-mask-image: radial-gradient(circle var(--m-size) at var(--mx) var(--my), rgba(0,0,0,1), rgba(0,0,0,0) 70%);
    will-change: transform, mask-image, -webkit-mask-image, filter;
    transition: opacity .15s ease;
  }
  .magnifier-enabled .bg-magnifier { opacity: 1; }
  @media (max-width: 780px){
    .bg-magnifier { display: none; }
  }
  .topbar{
    position: sticky; top: 0; z-index: 50;
    background: linear-gradient(180deg, rgba(10,15,20,0.9), rgba(10,15,20,0.6));
    backdrop-filter: saturate(130%) blur(12px);
    border-bottom: 1px solid var(--stroke);
  }
  .top-container{ max-width: 1000px; margin: 0 auto; padding: 18px 20px; }
  .brand-row{
    display: grid;
    grid-template-columns: 48px 1fr 48px;
    align-items: center;
    gap: 14px;
  }
  .logo{
    width: 48px; height: 48px;
    filter: drop-shadow(0 0 9px rgba(0,229,255,0.35));
  }
  .title{
    font-family: Orbitron, Inter, sans-serif;
    font-weight: 700; letter-spacing: 0.6px; margin:0;
    font-size: clamp(1.4rem, 1.2rem + 2vw, 2.2rem);
    text-align: center;
    text-shadow: 0 0 20px rgba(0,229,255,0.2);
  }
  .neon-bar{ height: 2px; width: 100%; background: linear-gradient(90deg, transparent, var(--accent), var(--accent-2), transparent); opacity: 0.5; }
  main {
    flex: 1 0 auto;
    padding: 20px 20px var(--bottom-pad);
    max-width: 1100px; margin: 0 auto;
    transition: padding-bottom .2s ease;
    display: flex;
    flex-direction: column;
  }
  .actions-top{
    display: flex; align-items: center; justify-content: center;
    margin-bottom: 14px;
  }
  .btn{
    appearance: none; border: 1px solid var(--stroke); color: var(--text);
    background: rgba(255,255,255,0.04);
    padding: 10px 14px; border-radius: 12px; font-weight: 700; letter-spacing: 0.2px;
    transition: transform .15s ease, background .2s ease, border-color .2s ease, box-shadow .2s ease;
    cursor: pointer; text-decoration: none; display:inline-flex; align-items:center; gap:8px;
  }
  .btn:hover{ background: rgba(255,255,255,0.08); transform: translateY(-1px); }
  .btn:focus-visible{ outline: none; box-shadow: var(--focus); }
  .btn-primary{
    border-color: rgba(0,229,255,0.45);
    background: linear-gradient(180deg, rgba(0,229,255,0.15), rgba(0,229,255,0.06));
  }
  .btn-primary:hover{
    background: linear-gradient(180deg, rgba(0,229,255,0.22), rgba(0,229,255,0.08));
    box-shadow: 0 0 24px rgba(0,229,255,0.25);
  }
  .btn-play{ padding: 12px 18px; font-size: 1rem; }
  .play-logo { width: 18px; height: 18px; display: inline-block; }
  .error-banner{
    display:none;
    margin-bottom: 12px;
    padding: 10px 12px;
    border-radius: 12px;
    background: rgba(255,72,122,0.12);
    border: 1px solid rgba(255,72,122,0.45);
    color: #ffd6e3;
  }
  .error-banner.show{ display:block; }
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.04));
    border: 1px solid var(--stroke);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    backdrop-filter: blur(14px) saturate(140%);
    overflow: hidden;
  }
  .table-wrap { width: 100%; overflow-x: hidden; }
  table {
    width: 100%;
    border-collapse: collapse;
    background: transparent;
    font-size: 0.98rem;
    table-layout: auto;
  }
  thead th{
    text-align: left; font-weight: 700; color: #cfe7ff; padding: 14px 16px;
    position: sticky; top: 0; background: rgba(12,18,26,0.7); backdrop-filter: blur(8px);
    border-bottom: 1px solid var(--stroke);
    white-space: nowrap;
  }
  thead th .th-mobile { display: none; }
  thead th.col-emoji { width: 48px; text-align: center; }
  thead th.col-rank { width: 72px; }
  tbody td{ padding: 14px 16px; border-bottom: 1px solid rgba(255,255,255,0.06); vertical-align: middle; }
  tbody td.col-emoji{ text-align: center; width: 48px; }
  tbody tr{ transition: background .15s ease; }
  tbody tr:nth-child(even){ background: rgba(255,255,255,0.02); }
  tbody tr:hover{ background: rgba(0,229,255,0.06); }
  .rank { font-weight: 700; color: #dffaff; display: inline-block; }
  .player { max-width: 340px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .address {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    letter-spacing: 0.2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    max-width: 280px; display: inline-block;
  }
  .score { font-variant-numeric: tabular-nums; font-weight: 700; }
  .crown { margin-left: 6px; }
  .cards-wrap { display: none !important; }
  .state { padding: 26px; text-align: center; color: var(--muted); }
  .skeleton{
    height: 14px; border-radius: 8px;
    background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.14), rgba(255,255,255,0.06));
    background-size: 200% 100%;
    animation: shimmer 1.4s ease-in-out infinite;
  }
  .sk-rank{ width: 30px; }
  .sk-name{ width: 60%; }
  .sk-addr{ width: 50%; }
  .sk-score{ width: 80px; }
  .sk-emoji{ width: 20px; }
  @keyframes shimmer { 0%{ background-position: 200% 0 } 100%{ background-position: -200% 0 } }
  .post-table-actions{

    margin-bottom: 16px;
  }
  .post-table-actions .contract-row{
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: 10px;
  }
  .contract-box{
    position: relative;
    display: block;
    padding: 12px 58px 12px 10px;
    border-radius: 12px;
    background: rgba(255,255,255,0.06);
    border: 1px solid var(--stroke);
    color: var(--text);
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    cursor: text;
  }
  .contract-box:focus-visible{ outline: none; box-shadow: var(--focus); }
  .copy-btn{
    position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
    width: 28px; height: 28px;
    border-radius: 8px;
    border: 1px solid var(--stroke);
    background: rgba(255,255,255,0.08);
    display: inline-grid; place-items: center;
    cursor: pointer;
    color: var(--text);
  }
  .copy-btn:hover{ background: rgba(255,255,255,0.14); }
  .copy-btn:focus-visible{ outline: none; box-shadow: var(--focus); }
  .copy-svg{ width: 18px; height: 18px; display:block; position: absolute; top: 50%; transform: translateY(-50%);}
  .actions-stack{
    display: grid; grid-auto-flow: column; gap: 10px; align-items: center;
  }
  .btn-icon{ display:inline-flex; align-items:center; gap:8px; padding: 10px 12px; }
  .btn-icon img{ width: 18px; height: 18px; display: block; }
  .bottom-region{
    position: fixed; left: 0; right: 0; bottom: 0; z-index: 40;
    padding: 12px 14px 18px;
    display:flex; justify-content: center;
    background: linear-gradient(0deg, rgba(10,15,20,0.96), rgba(10,15,20,0.88), rgba(10,15,20,0));
    border-top: 1px solid var(--stroke);
    backdrop-filter: blur(12px);
  }
  .bottom-wrap{ width: 100%; max-width: 1100px; display: grid; gap: 12px; }
  .socials-row{ display: flex; align-items: center; gap: 10px; flex-wrap: nowrap; }
  .socials-left{ display: flex; align-items: center; gap: 10px; flex-wrap: nowrap; }
  .btn-icon-only{ width: 40px; height: 40px; padding: 0; justify-content: center; }
  .btn-icon-only img{ width: 20px; height: 20px; display: block; }
  .spacer{ flex: 1 1 auto; }
  .faq-btn{ white-space: nowrap; }
  .overlay{
    position: fixed; inset: 0; z-index: 100; display:none;
    background: rgba(5,8,12,0.7);
    backdrop-filter: blur(8px) saturate(120%);
  }
  .overlay.open{ display:block; }
  .modal{
    position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
    width: min(760px, calc(100% - 32px));
    background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.05));
    border: 1px solid var(--stroke);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
  }
  .modal-header{
    display:flex; justify-content: space-between; align-items:center; padding: 14px 16px;
    border-bottom: 1px solid var(--stroke);
  }
  .modal-title{ margin: 0; font-family: Orbitron, Inter, sans-serif; letter-spacing: 0.6px; }
  .modal-body{ max-height: min(70vh, 720px); overflow: auto; padding: 16px; }
  .faq{ display: grid; gap: 14px; }
  .faq-item{
    background: rgba(255,255,255,0.04); border: 1px solid var(--stroke);
    border-radius: var(--radius-sm); padding: 14px 14px;
  }
  .faq-item h4{ margin: 0 0 6px 0; }
  .close-btn{
    width: 36px; height: 36px; border-radius: 10px;
    display:grid; place-items:center;
    border: 1px solid var(--stroke);
    background: rgba(255,255,255,0.06);
    cursor: pointer;
  }
  .close-btn:hover{ background: rgba(255,255,255,0.1); }
  .close-btn:focus-visible{ outline: none; box-shadow: var(--focus); }
  .toast{
    position: fixed; left: 50%; transform: translateX(-50%); bottom: 24px; z-index: 120;
    background: rgba(7,11,16,0.92); color: var(--text);
    border: 1px solid rgba(0,229,255,0.35);
    padding: 10px 14px; border-radius: 12px;
    display: none; align-items:  center; gap: 10px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.35);
  }
  .toast.show{ display: inline-flex; animation: toastIn .2s ease; }
  @keyframes toastIn { from { opacity: 0; transform: translate(-50%, 6px) } to { opacity: 1; transform: translate(-50%, 0) } }
  @media (min-width: 781px){
    .brand-row{ gap: 6px; }
    .title{ margin-left: -2px; margin-right: -2px; }
    .post-table-actions .contract-row{
      width: 75%;
      margin-left: auto;
      margin-right: auto;
    }
    .contract-box{
      display: inline-block;
      width: auto;
      max-width: 100%;
      padding: 10px 58px 10px 10px;
    }
    table { font-size: 0.95rem; }
    thead th{ padding: 12px 14px; }
    tbody td{ padding: 10px 14px; }
    thead th:nth-child(2),
    thead th:nth-child(3),
    thead th:nth-child(4) { padding-left: 24px; padding-right: 24px; }
    tbody td:nth-child(2),
    tbody td:nth-child(3),
    tbody td:nth-child(4) { padding-left: 24px; padding-right: 24px; }
  }
  @media (max-width: 780px){
    .brand-row{ grid-template-columns: 36px 1fr 36px; gap: 10px; }
    .logo{ width: 36px; height: 36px; }
    thead th{ padding: 10px 10px; white-space: nowrap; }
    tbody td{ padding: 10px 10px; }
    table{ font-size: 0.95rem; }
    thead th .th-desktop { display: none; }
    thead th .th-mobile { display: inline; }
    thead th.col-rank { width: 44px; }
    .address{ max-width: 120px; }
    .post-table-actions .contract-row{
      grid-template-columns: 1fr;
      row-gap: 10px;
    }
    .post-table-actions .actions-stack{
      display: grid;
      grid-auto-flow: row;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .btn-icon{
      justify-content: center;
      width: 100%;
    }
  }
</style>
</head>
<body>
  <div class="bg-magnifier" aria-hidden="true"></div>
  <header class="topbar" role="banner">
    <div class="top-container">
      <div class="brand-row" aria-label="Project brand">
        <img class="logo" src="assets/logo1.svg" alt="Dukes & Peasants logo left" />
        <h1 class="title">Dukes &amp; Peasants</h1>
        <img class="logo" src="assets/logo2.svg" alt="Dukes & Peasants logo right" />
      </div>
    </div>
    <div class="neon-bar" aria-hidden="true"></div>
  </header>
  <main id="main">
    <div id="errorBanner" class="error-banner" role="alert" aria-live="polite"></div>
    <div class="actions-top">
      <a id="playBtn" class="btn btn-primary btn-play" href="#" target="_blank" rel="noopener noreferrer" aria-label="Play Dukes &amp; Peasants">
        <img class="play-logo" src="assets/logo.svg" alt="logo" />
        PLAY NOW
      </a>
    </div>
    <section class="post-table-actions" aria-label="Contract and actions over leaderboard">
      <div class="contract-row">
        <div id="contractBox" class="contract-box" tabindex="0" role="button" aria-label="Contract address (focusable)" title="Contract address (select to copy)">
          <span id="contractText"></span>
          <button id="copyBtn" class="copy-btn" aria-label="Copy contract" title="Copy contract">
            <img class="copy-svg" src="assets/copy.svg" alt="Copy" />
          </button>
        </div>
        <div class="actions-stack">
          <a id="chartBtn" class="btn btn-icon" target="_blank" rel="noopener noreferrer" aria-label="Open Dexscreener chart">
            <img src="assets/dexscreener.svg" alt="Dexscreener" />
            <span class="btn-label">Chart</span>
          </a>
          <a id="buyBtn" class="btn btn-icon" target="_blank" rel="noopener noreferrer" aria-label="Open Buy link">
            <img src="assets/pumpfun.svg" alt="Pump.fun" />
            <span class="btn-label">Buy</span>
          </a>
        </div>
      </div>
    </section>
    <section class="card" aria-label="Leaderboard">
      <div class="table-wrap" id="tableWrap">
        <table aria-describedby="leaderboard-desc">
          <caption id="leaderboard-desc" style="position:absolute;left:-9999px;opacity:0;">
            Sorted by Beat the Game (Yes first), then Best Score (descending), then Follower (Yes first).
          </caption>
          <thead>
            <tr>
              <th scope="col" class="col-rank">
                <span class="th-desktop">Rank</span>
                <span class="th-mobile" aria-hidden="true"></span>
              </th>
              <th scope="col">Name</th>
              <th scope="col">Solana Address</th>
              <th scope="col">
                <span class="th-desktop">Best Score</span>
                <span class="th-mobile">Score</span>
              </th>
              <th scope="col" class="col-emoji"></th>
            </tr>
          </thead>
          <tbody id="tbody">
          </tbody>
        </table>
      </div>
      <div class="cards-wrap" id="cardsWrap" aria-label="Leaderboard (mobile cards hidden)"></div>
      <div id="state" class="state" style="display:none;"></div>
    </section>

  </main>
  <div class="bottom-region" role="complementary" aria-label="Project links and contract info" id="bottomRegion">
    <div class="bottom-wrap">
      <div class="socials-row" aria-label="Social links">
        <div class="socials-left">
          <a id="twitterLink" class="btn btn-icon-only" href="#" target="_blank" rel="noopener noreferrer" aria-label="Twitter">
            <img src="assets/twitter.svg" alt="Twitter" />
          </a>
          <a id="discordLink" class="btn btn-icon-only" href="#" target="_blank" rel="noopener noreferrer" aria-label="Discord">
            <img src="assets/discord.svg" alt="Discord" />
          </a>
          <a id="telegramLink" class="btn btn-icon-only" href="#" target="_blank" rel="noopener noreferrer" aria-label="Telegram">
            <img src="assets/telegram.svg" alt="Telegram" />
          </a>
        </div>
        <div class="spacer" aria-hidden="true"></div>
        <button id="faqBtn" class="btn faq-btn" aria-haspopup="dialog" aria-controls="faqOverlay" aria-label="Open FAQ" title="FAQ">FAQ</button>
      </div>
    </div>
  </div>
  <div id="faqOverlay" class="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="faqTitle">
      <div class="modal-header">
        <h3 id="faqTitle" class="modal-title">Frequently Asked Questions</h3>
        <button id="closeFaqBtn" class="close-btn" aria-label="Close FAQ" title="Close">
          <span aria-hidden="true">✕</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="faq">
          <div class="faq-item">
            <h4>What is this?</h4>
            <p>Well, most people would call it a leaderboard, you BOZO.</p>
          </div>
          <div class="faq-item">
            <h4>Will there be rewards?</h4>
            <p>Why would there be a leaderboard otherwise?</p>
          </div>
          <div class="faq-item">
            <h4>How do I try the game?</h4>
            <p>When you click on "Play Now", you will be redirected to the telegram bot. Send a /start to start the game!</p>
          </div>
          <div class="faq-item">
            <h4>Is the game free to play?</h4>
            <p>Every user has one free session to start with. If you want more, feel free to come to the discord and ask around.</p>
          </div>
          <div class="faq-item">
            <h4>How can I get on the leaderboard?</h4>
            <p>The leaderboard holds the score of the top 100 players, high scores matter... But beating the game matters the most.</p>
          </div>
          <div class="faq-item">
            <h4>How do I get a 👑?</h4>
            <p>Become a duke and you'll get one.</p>
          </div>
          <div class="faq-item">
            <h4>What does the 🐧 mean?</h4>
            <p>Well... It's a penguin.</p>
          </div>
          <div class="faq-item">
            <h4>What do I do?</h4>
            <p>You can usually choose between two actions and two movements. They're chosen randomly from a pool. Choose wisely!</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="toast" class="toast" role="status" aria-live="polite">
    <span id="toastMsg">Copied!</span>
  </div>
  <div id="srAnnounce" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;" aria-live="polite"></div>
<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
  const SUPABASE_URL = 'https://poxiozhybwvscgklmuhm.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBveGlvemh5Ynd2c2Nna2xtdWhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4NzM0NjQsImV4cCI6MjA3MzQ0OTQ2NH0.q2uAUAeaHzW3vYgoHlvJA_lAHYp5GK2AiLmIk9nFnvE';
  const TABLE_NAME = 'users_public';
  const CONTRACT_ADDRESS = '...';
  const DEXSCREENER_URL = 'https://dexscreener.com/solana/'+CONTRACT_ADDRESS;
  const BUY_URL = 'https://pump.fun/'+CONTRACT_ADDRESS;
  const TWITTER_URL = 'https://x.com/dukesnpeasants';
  const DISCORD_URL = 'https://discord.com/invite/WKa5Fw2k62';
  const TELEGRAM_URL = 'https://t.me/TheGatekeeping_bot';
  const PLAY_URL = 'https://t.me/TheGatekeeping_bot';
  const tbody = document.getElementById('tbody');
  const cardsWrap = document.getElementById('cardsWrap');
  const stateEl = document.getElementById('state');
  const errorBanner = document.getElementById('errorBanner');
  const contractBox = document.getElementById('contractBox');
  const contractText = document.getElementById('contractText');
  const copyBtn = document.getElementById('copyBtn');
  const chartBtn = document.getElementById('chartBtn');
  const buyBtn = document.getElementById('buyBtn');
  const twitterLink = document.getElementById('twitterLink');
  const discordLink = document.getElementById('discordLink');
  const telegramLink = document.getElementById('telegramLink');
  const playBtn = document.getElementById('playBtn');
  const toast = document.getElementById('toast');
  const toastMsg = document.getElementById('toastMsg');
  const srAnnounce = document.getElementById('srAnnounce');
  const faqBtn = document.getElementById('faqBtn');
  const faqOverlay = document.getElementById('faqOverlay');
  const closeFaqBtn = document.getElementById('closeFaqBtn');
  const bottomRegion = document.getElementById('bottomRegion');
  (function applyConfig() {
    try {
      contractText.textContent = CONTRACT_ADDRESS;
      chartBtn.href = DEXSCREENER_URL;
      buyBtn.href = BUY_URL;
      twitterLink.href = TWITTER_URL;
      discordLink.href = DISCORD_URL;
      telegramLink.href = TELEGRAM_URL;
      playBtn.href = PLAY_URL;
    } catch (_) {}
  })();
  function announce(msg){
    srAnnounce.textContent = '';
    setTimeout(()=>{ srAnnounce.textContent = msg; }, 10);
  }
  let toastTimer = null;
  function showToast(message = 'Copied!'){
    toastMsg.textContent = message;
    toast.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=> toast.classList.remove('show'), 1800);
  }
  async function copyContract(){
    try{
      await navigator.clipboard.writeText(CONTRACT_ADDRESS);
      showToast('Contract copied');
      announce('Contract address copied to clipboard');
    }catch{
      showToast('Copy failed');
    }
  }
  contractBox.addEventListener('click', (e)=>{});
  contractBox.addEventListener('keydown', (e)=>{});
  copyBtn.addEventListener('click', (e)=>{ e.stopPropagation(); copyContract(); });
  copyBtn.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter' || e.key === ' '){
      e.preventDefault();
      e.stopPropagation();
      copyContract();
    }
  });
  function getFocusable(root){
    return Array.from(root.querySelectorAll(
      'a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])'
    )).filter(el => (el.offsetParent !== null) || el === document.activeElement);
  }
  function maintainTrapFocus(e){
    const focusables = getFocusable(faqOverlay);
    if(focusables.length === 0) return;
    const first = focusables[0];
    const last = focusables[focusables.length - 1];
    const active = document.activeElement;
    if(e.shiftKey && active === first){ e.preventDefault(); last.focus(); }
    else if(!e.shiftKey && active === last){ e.preventDefault(); first.focus(); }
  }
  function handleModalKeydown(e){
    if(e.key === 'Escape'){ e.preventDefault(); closeFaq(); return; }
    if(e.key === 'Tab'){ maintainTrapFocus(e); }
  }
  function onOverlayClick(e){
    const modal = faqOverlay.querySelector('.modal');
    if(!modal.contains(e.target)){ closeFaq(); }
  }
  function openFaq(){
    faqOverlay.classList.add('open');
    faqOverlay.setAttribute('aria-hidden','false');
    const first = getFocusable(faqOverlay)[0];
    first?.focus();
    document.addEventListener('keydown', handleModalKeydown);
    faqOverlay.addEventListener('mousedown', onOverlayClick);
  }
  function closeFaq(){
    faqOverlay.classList.remove('open');
    faqOverlay.setAttribute('aria-hidden','true');
    document.removeEventListener('keydown', handleModalKeydown);
    faqOverlay.removeEventListener('mousedown', onOverlayClick);
    faqBtn?.focus();
  }
  faqBtn.addEventListener('click', openFaq);
  closeFaqBtn.addEventListener('click', closeFaq);
  function adjustBottomPadding(){
    try{
      const h = bottomRegion?.offsetHeight || 0;
      document.documentElement.style.setProperty('--bottom-pad', (h + 24) + 'px');
    }catch{}
  }
  window.addEventListener('resize', adjustBottomPadding);
  window.addEventListener('load', adjustBottomPadding);
  function escapeHtml(s){
    return String(s ?? '').replace(/[&<>\"']/g, (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;', "'":'&#39;' }[m]));
  }
  const formatNumber = (n)=> typeof n === 'number' ? n.toLocaleString(undefined, { maximumFractionDigits: 0 }) : '-';
  function truncateAddressDesktop(addr){
    if(!addr) return '—';
    const s = String(addr);
    if(s.length <= 12) return s;
    return `${s.slice(0,6)}...${s.slice(-6)}`;
  }
  function truncateAddressMobile(addr){
    if(!addr) return '—';
    const s = String(addr);
    if(s.length <= 6) return s;
    return `${s.slice(0,3)}...${s.slice(-3)}`;
  }
  const isMobile = ()=> window.matchMedia && window.matchMedia('(max-width: 780px)').matches;
  function showErrorBanner(msg){
    if(!errorBanner) return;
    errorBanner.textContent = msg;
    errorBanner.classList.add('show');
  }
  function clearErrorBanner(){
    if(!errorBanner) return;
    errorBanner.textContent = '';
    errorBanner.classList.remove('show');
  }
  let supabase = null;
  try {
    supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  } catch (e) {
    showErrorBanner('Failed to initialize data client.');
  }
  function renderTableSkeleton(count = 6){
    stateEl.style.display = 'none';
    tbody.innerHTML = '';
    for(let i=0;i<count;i++){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><div class="skeleton sk-rank"></div></td>
        <td><div class="skeleton sk-name"></div></td>
        <td><div class="skeleton sk-addr"></div></td>
        <td><div class="skeleton sk-score"></div></td>
        <td class="col-emoji"><div class="skeleton sk-emoji"></div></td>
      `;
      tbody.appendChild(tr);
    }
  }
  function renderCardsSkeleton(){}
  function renderTableRows(rows){
    tbody.innerHTML = '';
    if(!rows || rows.length === 0){
      stateEl.textContent = 'No entries yet. Be the first to conquer the board.';
      stateEl.style.display = 'block';
      return;
    }
    stateEl.style.display = 'none';
    let rank = 1;
    for(const item of rows){
      const name = (item.name ?? '').toString();
      const fullAddr = item.sol_address ? String(item.sol_address) : '';
      const score = typeof item.best_score === 'number' ? item.best_score : null;
      const beat = !!item.has_beaten_game;
      const follower = !!item.has_follower;
      const addrDisplay = isMobile() ? truncateAddressMobile(fullAddr) : truncateAddressDesktop(fullAddr);
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><span class="rank">#${rank}</span></td>
        <td><span class="player" title="${escapeHtml(name || '—')}">${escapeHtml(name || '—')}${beat ? ' <span class="crown" title="Beat the game" aria-label="Beat the game">👑</span>' : ''}</span></td>
        <td><span class="address" title="${escapeHtml(fullAddr || '—')}">${escapeHtml(addrDisplay)}</span></td>
        <td><span class="score" title="${score !== null ? formatNumber(score) : '-'}">${score !== null ? formatNumber(score) : '-'}</span></td>
        <td class="col-emoji">${follower ? '<span role="img" aria-label="Has follower" title="Has follower">🐧</span>' : ''}</td>
      `;
      tbody.appendChild(tr);
      rank++;
    }
  }
  function renderCardRows(){}
  let isFetching = false;
  async function fetchLeaderboard({ showSkeleton = false } = {}){
    if(!supabase){
      showErrorBanner('Data client not available.');
      return;
    }
    if(isFetching) return;
    isFetching = true;
    clearErrorBanner();
    if(showSkeleton){
      renderTableSkeleton(6);
      renderCardsSkeleton(6);
    }
    try{
      const { data, error } = await supabase
        .from(TABLE_NAME)
        .select('user_id, name, sol_address, best_score, has_beaten_game, has_follower, updated_at')
        .order('has_beaten_game', { ascending: false })
        .order('best_score', { ascending: false })
        .order('has_follower', { ascending: false })
        .limit(100);
      if(error){
        showErrorBanner('Failed to load leaderboard.');
        return;
      }
      renderTableRows(data || []);
      adjustBottomPadding();
    }catch(err){
      showErrorBanner('Unexpected error while fetching data.');
    }finally{
      isFetching = false;
    }
  }
  let channel = null;
  function setupRealtime(){
    if(!supabase) return;
    try{
      channel = supabase.channel('users_public_changes')
        .on('postgres_changes', { event: 'INSERT', schema: 'public', table: TABLE_NAME }, scheduleAutoRefresh)
        .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: TABLE_NAME }, scheduleAutoRefresh)
        .subscribe();
    }catch(e){}
  }
  window.addEventListener('beforeunload', ()=> { try{ channel?.unsubscribe(); }catch{} });
  let autoRefreshPending = false;
  function scheduleAutoRefresh(){
    if(autoRefreshPending) return;
    autoRefreshPending = true;
    setTimeout(async ()=>{
      await fetchLeaderboard();
      autoRefreshPending = false;
    }, 400);
  }
  setInterval(()=> { fetchLeaderboard(); }, 60000);
  renderTableSkeleton(6);
  fetchLeaderboard({ showSkeleton: false }).then(()=> setupRealtime());
  adjustBottomPadding();
  window.addEventListener('resize', async ()=>{
    await fetchLeaderboard();
  });
  (function setupMagnifier(){
    const magnifier = document.querySelector('.bg-magnifier');
    if(!magnifier) return;
    const mq = window.matchMedia('(min-width: 781px) and (pointer: fine)');
    function enableMagnifier(){
      document.body.classList.add('magnifier-enabled');
    }
    function disableMagnifier(){
      document.body.classList.remove('magnifier-enabled');
      magnifier.style.setProperty('--mx', '50%');
      magnifier.style.setProperty('--my', '50%');
    }
    function updateState(){
      if(mq.matches) enableMagnifier();
      else disableMagnifier();
    }
    let raf = null;
    let last = null;
    function onMove(e){
      if(!mq.matches) return;
      last = { x: e.clientX, y: e.clientY };
      if(raf) return;
      raf = requestAnimationFrame(()=>{
        raf = null;
        if(!last) return;
        magnifier.style.setProperty('--mx', last.x + 'px');
        magnifier.style.setProperty('--my', last.y + 'px');
      });
    }
    updateState();
    mq.addEventListener?.('change', updateState);
    window.addEventListener('resize', updateState);
    window.addEventListener('mousemove', onMove, { passive: true });
  })();
</script>
</body>
</html>